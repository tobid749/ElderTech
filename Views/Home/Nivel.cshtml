@model Eldertech.Models.NivelViewModel

@{
    ViewData["Title"] = "Nivel " + Model.NumeroNivel;
}

<header>
  <nav>
    <div class="nav-left">
      <a href='@Url.Action("Index", "Home")' aria-label="Inicio ElderTech" class="brand">
        <img src="/Imagenes/Logo.png" alt="Logo ElderTech" class="logo">
      </a>

      <form action='@Url.Action("Articulos", "Home")' method="get" class="search-form" role="search">
        <input type="search" name="q" placeholder="Buscar art√≠culos" aria-label="Buscar art√≠culos">
        <button type="submit" class="search-btn">üîç</button>
      </form>
    </div>

    <ul class="nav-links">
      <li><a href='@Url.Action("Articulos", "Home")'style="background-color: #008D36;">Articulos</a></li>
      <li><a href='@Url.Action("Camino", "Home")'>Camino</a></li>
      <li><a href='@Url.Action("Aplicaciones", "Home")'>Aplicaciones</a></li>
      <li><a href='@Url.Action("Foro", "Home")'>Foro</a></li>
      <li><a href='@Url.Action("Contacto", "Home")'>Contacto</a></li>
      <li><a href='@Url.Action("NecesitoAyuda", "Home")'>Necesito Ayuda</a></li>
    </ul>
  </nav>
</header>

<section class="nivel-fondo">

    <!-- T√≠tulo de la aplicaci√≥n -->
    <h1 class="nivel-titulo">@Model.TituloApp</h1>

    <!-- Barra de progreso -->
    <div class="nivel-progress-container">
        <div class="nivel-progress-fill" style="width:@Model.PorcentajeCompletado%;"></div>
    </div>

    <!-- Pregunta -->
    <h2 class="nivel-pregunta">@Model.Pregunta</h2>

    <!-- Opciones -->
    <div class="nivel-opciones">
        @foreach (var opcion in Model.Opciones)
        {
            <button class="nivel-opcion"
                    data-correct="@opcion.EsCorrecta.ToString().ToLower()">
                @opcion.Texto
            </button>
        }

    </div>
    <div id="resultado-estrellas" class="estrellas-popup">
    <span class="estrella-pop">‚≠ê</span>
    <span class="estrella-pop">‚≠ê</span>
    <span class="estrella-pop">‚≠ê</span>
    <p>¬°Bien hecho!</p>
</div>


<a id="btnSiguiente"
   href="#"
   class="nivel-siguiente disabled"
   data-baseurl="@Url.Action("Nivel", "Home")"
   data-id="@Model.NumeroNivel"
   data-index="@Model.IndexPregunta"
   data-correctas="@Model.CorrectasHastaAhora">
    ‚û§
</a>




</section>

<script>
document.querySelectorAll(".nivel-opcion").forEach(btn => {

    btn.addEventListener("click", function () {

        // Evita doble click
        if (document.body.classList.contains("respondido")) return;
        document.body.classList.add("respondido");

        let correcto = (this.dataset.correct === "true");

        // Colorear botones
        if (correcto) {
            this.classList.add("correcta");
        } else {
            this.classList.add("incorrecta");

            // mostrar autom√°ticamente la correcta
            document.querySelectorAll(".nivel-opcion").forEach(o => {
                if (o.dataset.correct === "true") {
                    o.classList.add("correcta");
                }
            });
        }

        // ACTIVAR EL BOT√ìN "SIGUIENTE" SIEMPRE A LOS 2s
        setTimeout(() => {

            const btnSig = document.getElementById("btnSiguiente");

            btnSig.classList.remove("disabled");

            // Tomar los datos actuales
            let base = btnSig.dataset.baseurl;
            let id = btnSig.dataset.id;
            let index = parseInt(btnSig.dataset.index);
            let correctas = parseInt(btnSig.dataset.correctas);

            // si fue correcta la suma
            if (correcto)
                correctas++;

            // construir la URL siguiente
            btnSig.href = `${base}?id=${id}&index=${index + 1}&correctas=${correctas}`;

        }, 2000);

    });
});
</script>



