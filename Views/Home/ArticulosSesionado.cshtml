<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElderTech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="~/css/estilos.css">
</head>
<body>


<header>
  <nav>
    <section class="nav-left">
      <a href='@Url.Action("IndexSesionado", "Home")' aria-label="Inicio ElderTech">
      <img src="/Imagenes/Logo.png" alt="Logo ElderTech">
      </a>


        <section class="search-form">
              <form action='@Url.Action("Articulos", "Home")' method="get"  role="search">
                 <input type="search" name="q" placeholder="Buscar art√≠culos" aria-label="Buscar art√≠culos">
                 <button type="submit" >üîç</button>
               </form>
      </section>
    </section>




     <section  class="nav-links">
    <ul>
      <li><a href='@Url.Action("ArticulosSesionado", "Home")'>Articulos</a></li>
      <li><a href='@Url.Action("Camino", "Home")'>Camino</a></li>
      <li><a href='@Url.Action("Aplicaciones", "Home")'>Aplicaciones</a></li>
      <li><a href='@Url.Action("ForoSesionado", "Home")'>Foro</a></li>
      <li><a href='@Url.Action("Contacto", "Home")'>Contacto</a></li>
      <li><a href='@Url.Action("NecesitoAyuda", "Home")'>Necesito Ayuda</a></li>
    </ul>
    </section>
   <div class="perfil-wrapper">

    <img src="@ViewBag.FotoPerfil" class="perfil-img" id="perfilBtn" />

    <div class="menu-perfil" id="menuPerfil">

        <!-- NOMBRE DE USUARIO -->
        <p class="perfil-nombre">
            <strong>@ViewBag.NombreUsuario</strong>
        </p>

        <!-- MAIL -->
        <p class="perfil-mail">
            üìß @ViewBag.Mail
        </p>

        <!-- FECHA DE NACIMIENTO -->
        <p class="perfil-fecha">
            üìÖ @ViewBag.FechaNacimiento
        </p>

        <hr />

        <!-- CAMBIAR FOTO -->
        <form asp-action="CambiarFoto" asp-controller="Home"
              method="post" enctype="multipart/form-data">
            <input type="file" name="foto" accept="image/*" class="perfil-file" />
            <button type="submit" class="btn-cambiar-foto">Cambiar foto</button>
        </form>

        <!-- LOGOUT -->
        <a href="@Url.Action("Logout","Home")" class="logout-btn">
            Cerrar sesi√≥n
        </a>
    </div>

</div>

  </nav>
</header>

<section class="banner-eldertech">
    <h1><span>Art√≠culos</span></h1>
</section>

<main class="container mt-5">
  <div class="articulos-grid">
    @foreach (var art in Model)
    {
      <a class="articulo" href='@Url.Action("Articulo","Home", new { id = art.IDArticulo })'>
        <img src="@art.Foto" alt="@art.Titulo" class="articulo-img" />

        <div class="articulo-info">
          <h3>@art.Titulo</h3>

          @if (!string.IsNullOrEmpty(art.Subtitulo))
          {
            <p>@art.Subtitulo</p>
          }

          <p><b>@art.Autor</b> - @art.Fecha.ToString("dd/MM/yy")</p>
        </div>
      </a>
    }
  </div>
</main>
<section class="paginacion">
    @for (int i = 1; i <= ViewBag.TotalPaginas; i++)
    {
        if (i == ViewBag.PaginaActual)
        {
            <section class="pagina-actual">
                <a href="@Url.Action("Articulos","Home", new { pagina = i })">@i</a>
            </section>
        }
        else
        {
            <a href="@Url.Action("Articulos","Home", new { pagina = i })">@i</a>
        }
    }
</section>

</body>
</html>
<script>
const btn = document.getElementById("perfilBtn");
const menu = document.getElementById("menuPerfil");

btn.addEventListener("click", function (e) {
    e.stopPropagation();
    menu.style.display = menu.style.display === "block" ? "none" : "block";
});

document.addEventListener("click", function (e) {
    if (!menu.contains(e.target) && e.target !== btn) {
        menu.style.display = "none";
    }
});

// VALIDAR CAMBIO DE FOTO
const formCambiarFoto = document.getElementById("formCambiarFoto");
const inputFoto = document.getElementById("inputFoto");

if (formCambiarFoto && inputFoto) {
    formCambiarFoto.addEventListener("submit", function (e) {
        if (!inputFoto.value) {
            e.preventDefault();
            alert("Por favor eleg√≠ una foto antes de cambiarla üôÇ");
        }
    });
}
</script>