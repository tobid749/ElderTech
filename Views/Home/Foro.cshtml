@model IEnumerable<Eldertech.Models.ForoMensaje>

@{
    ViewData["Title"] = "Foro";
}

<body>
<header>
    <nav>
        <!-- IZQUIERDA: LOGO + BUSCADOR -->
        <section class="nav-left">
            <a href='@Url.Action("Index", "Home")' aria-label="Inicio ElderTech">
                <img src="/Imagenes/Logo.png" alt="Logo ElderTech">
            </a>

            <section class="search-form">
                <form action='@Url.Action("Articulos", "Home")' method="get" role="search">
                    <input type="search" name="q" placeholder="Buscar art√≠culos" aria-label="Buscar art√≠culos">
                    <button type="submit">üîç</button>
                </form>
            </section>
        </section>

        <!-- DERECHA: BOTONES -->
        <section class="nav-links">
            <ul>
                <li><a href='@Url.Action("Articulos", "Home")'>Art√≠culos</a></li>
                <li><a href='@Url.Action("Aplicaciones", "Home")'>Aplicaciones</a></li>
                <li><a href='@Url.Action("Foro", "Home")' style="background-color:#008D36;">Foro</a></li>
                <li><a href='@Url.Action("IniciarSesion", "Home")' class="btn-login">Iniciar Sesi√≥n</a></li>
                <li><a href='@Url.Action("Registrarse", "Home")' class="btn-register">Registrarse</a></li>
            </ul>
        </section>
    </nav>
</header>

<main>
    <section class="banner-eldertech">
        <h1><span>Foro</span></h1>
    </section>

    <!-- BLOQUE PUBLICAR (MISMO ESTILO QUE SESIONADO) -->
    <section class="foro-publicar mt-5">
        <h4>Escribir un mensaje:</h4>

        <!-- Mismo layout de formulario, pero lo frenamos por JS -->
        <form id="form-foro-publico">
            <textarea name="mensaje"
                      id="mensaje"
                      class="form-control mb-3"
                      rows="4"
                      placeholder="Escribe tu mensaje..."
                      required></textarea>

            <button type="submit" class="btn btn-success">
                Publicar
            </button>
        </form>

        <div id="msg-error"
             class="alert alert-danger mt-3"
             style="display:none;">
            ‚ùå Debes iniciar sesi√≥n para publicar un mensaje.
            <br />
            <a href='@Url.Action("IniciarSesion","Home")' class="btn btn-sesion">
                Iniciar Sesi√≥n
            </a>
        </div>
    </section>

    <hr />

    <!-- TARJETAS DEL FORO: MISMAS QUE EN FOROSESIONADO PERO SIN CLICK -->
    <div class="foro-grid">
        @foreach (var m in Model)
        {
            <div class="foro-card">
                <div class="foro-perfil">
                    <img src="@m.Avatar" alt="Avatar @m.NombreUsuario" class="foro-avatar">
                    <h4>@m.NombreUsuario</h4>
                    <p>@m.Fecha.ToString("dd/MM/yyyy ‚Ä¢ HH:mm")</p>
                </div>
                <p class="foro-texto">@m.Mensaje</p>
            </div>
        }
    </div>

    @if (ViewBag.MostrarMas)
    {
        <form method="get" asp-action="Foro">
            <input type="hidden" name="offset" value="@(ViewBag.Offset + 6)" />
            <button class="btn btn-primary mt-4">Ver m√°s</button>
        </form>
    }
</main>
</body>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form  = document.getElementById("form-foro-publico");
            const error = document.getElementById("msg-error");

            if (form && error) {
                form.addEventListener("submit", function (e) {
                    e.preventDefault(); // üëâ no se manda al servidor

                    error.style.display = "block";

                    // animaci√≥n suave
                    error.style.opacity = 0;
                    setTimeout(() => {
                        error.style.transition = "0.4s";
                        error.style.opacity = 1;
                    }, 10);

                    // baja un poco el scroll para que se vea
                    error.scrollIntoView({ behavior: "smooth", block: "center" });
                });
            }
        });
    </script>
}
