@model Eldertech.Models.Aplicacion
@{
    ViewData["Title"] = Model.Nombre;
    var preguntas = ViewBag.Preguntas as List<Eldertech.Models.PreguntaAplicacion>;
}
<body>
<header>
  <nav>
    <section class="nav-left">
      <a href='@Url.Action("IndexSesionado", "Home")' aria-label="Inicio ElderTech">
      <img src="/Imagenes/Logo.png" alt="Logo ElderTech">
      </a>


        <section class="search-form">
              <form action='@Url.Action("Articulos", "Home")' method="get"  role="search">
                 <input type="search" name="q" placeholder="Buscar art√≠culos" aria-label="Buscar art√≠culos">
                 <button type="submit" >üîç</button>
               </form>
      </section>
    </section>




     <section  class="nav-links">
    <ul>
      <li><a href='@Url.Action("ArticulosSesionado", "Home")'>Articulos</a></li>
      <li><a href='@Url.Action("Camino", "Home")'>Camino</a></li>
      <li><a href='@Url.Action("Aplicaciones", "Home")'>Aplicaciones</a></li>
      <li><a href='@Url.Action("ForoSesionado", "Home")'>Foro</a></li>
      <li><a href='@Url.Action("Contacto", "Home")'>Contacto</a></li>
      <li><a href='@Url.Action("NecesitoAyuda", "Home")'>Necesito Ayuda</a></li>
    </ul>
    </section>
   <div class="perfil-wrapper">

    <img src="@ViewBag.FotoPerfil" class="perfil-img" id="perfilBtn" />

    <div class="menu-perfil" id="menuPerfil">

        <!-- NOMBRE DE USUARIO -->
        <p class="perfil-nombre">
            <strong>@ViewBag.NombreUsuario</strong>
        </p>

        <!-- MAIL -->
        <p class="perfil-mail">
            üìß @ViewBag.Mail
        </p>

        <!-- FECHA DE NACIMIENTO -->
        <p class="perfil-fecha">
            üìÖ @ViewBag.FechaNacimiento
        </p>

        <hr />

        <!-- CAMBIAR FOTO -->
        <form asp-action="CambiarFoto" asp-controller="Home"
              method="post" enctype="multipart/form-data">
            <input type="file" name="foto" accept="image/*" class="perfil-file" />
            <button type="submit" class="btn-cambiar-foto">Cambiar foto</button>
        </form>

        <!-- LOGOUT -->
        <a href="@Url.Action("Logout","Home")" class="logout-btn">
            Cerrar sesi√≥n
        </a>
    </div>

</div>

  </nav>
</header>




<section class="banner-eldertech">
    <h1>@Model.Nombre</h1>
</section>


<main >
    <section class="aplicacion-contenedor">


    <section class="aplicacion-content">


        <section class="aplicacion-img-container">
            <img src="@Model.Foto" alt="@Model.Nombre">
        </section>


        <section class="aplicacion-preguntas">
            <h2>Preguntas</h2>


          @{
             var pregunta = ViewBag.PreguntaActual as Eldertech.Models.PreguntaAplicacion;
             var opciones = ViewBag.OpcionesMezcladas as List<(string texto, int num)>;
            }


@if (pregunta != null && opciones != null)
{
    <section class="pregunta" data-correcta="@pregunta.Correcta">
        <section class="pregunta">
        <p >@pregunta.Enunciado</p>
        </section>


        <section class="respuesta-grid">
            @foreach (var op in opciones)
            {
                <button data-num="@op.num">@op.texto</button>
            }
        </section>


        <form method="post" asp-action="Siguiente" asp-route-id="@Model.IDAplicacion" asp-route-next="@ViewBag.NextIndex">
           <section class="btn-siguiente">
    <button id="btnSiguiente" disabled>Siguiente ‚ûú</button>
</section>
        </form>
    </section>
}
else
{
     <section class="sinPreguntas">
         <p>Muy pronto vas a poder practicar con preguntas de esta aplicaci√≥n ‚úÖ</p>
        </section>
   
}




        </section>
    </section>


    <section class="articulos-title">
        <h2>Art√≠culos relacionados</h2>
    </section>


    <section class="articulos-rel">
        <p style="color:#777; text-align:center;">Muy pronto disponibles ‚úÖ</p>
    </section>
</section>
</main>
</body>






@section Scripts {
<script>
document.addEventListener("DOMContentLoaded", function () {
    const preguntas = document.querySelectorAll('.pregunta button[data-num]');
    if (!preguntas.length) return;

    preguntas.forEach(btn => {
        btn.addEventListener('click', () => {
            const cont = btn.closest('.pregunta');
            const correcta = cont.dataset.correcta;
            const botones = cont.querySelectorAll('button[data-num]');
            const nextBtn = document.getElementById("btnSiguiente");

            let msg = cont.querySelector('.resultado-msg');
            if (!msg) {
                msg = document.createElement('p');
                msg.classList.add('resultado-msg');
                cont.appendChild(msg);
            }

            botones.forEach(b => {
                b.disabled = true;
                if (b.dataset.num === correcta) {
                    b.classList.add('correcta');
                } else if (b === btn) {
                    b.classList.add('incorrecta');
                }
            });

            if (btn.dataset.num === correcta) {
                msg.textContent = "¬°Correcto! ‚úÖ";
                msg.className = "resultado-msg correcto-msg";
            } else {
                msg.textContent = "Ups, no era esa üòÖ";
                msg.className = "resultado-msg incorrecto-msg";
            }

            msg.style.opacity = "1";

            setTimeout(() => {
                msg.style.opacity = "0";
                if (nextBtn) nextBtn.disabled = false;
            }, 1500);
        });
    });
});
const btn = document.getElementById("perfilBtn");
const menu = document.getElementById("menuPerfil");

btn.addEventListener("click", function (e) {
    e.stopPropagation();
    menu.style.display = menu.style.display === "block" ? "none" : "block";
});

document.addEventListener("click", function (e) {
    if (!menu.contains(e.target) && e.target !== btn) {
        menu.style.display = "none";
    }
});

// VALIDAR CAMBIO DE FOTO
const formCambiarFoto = document.getElementById("formCambiarFoto");
const inputFoto = document.getElementById("inputFoto");

if (formCambiarFoto && inputFoto) {
    formCambiarFoto.addEventListener("submit", function (e) {
        if (!inputFoto.value) {
            e.preventDefault();
            alert("Por favor eleg√≠ una foto antes de cambiarla üôÇ");
        }
    });
}

</script>
}

}
